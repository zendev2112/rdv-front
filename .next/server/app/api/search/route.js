"use strict";(()=>{var e={};e.id=280,e.ids=[280],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3293:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>m,patchFetch:()=>f,requestAsyncStorage:()=>h,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>d});var o={};t.r(o),t.d(o,{GET:()=>u,dynamic:()=>l});var n=t(9303),s=t(8716),a=t(670),i=t(7070),c=t(5662);let l="force-dynamic";async function u(e){try{let r=e.nextUrl.searchParams.get("q")||"";if(!r||r.length<3)return i.NextResponse.json({articles:[]});let{data:t,error:o}=await c.OQ.rpc("search_articles",{search_query:r});if(o)return console.error("Search error:",o),i.NextResponse.json({error:"Search failed"},{status:500});return i.NextResponse.json({articles:t||[]})}catch(e){return console.error("Search error:",e),i.NextResponse.json({error:"Search failed"},{status:500})}}let p=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/search/route",pathname:"/api/search",filename:"route",bundlePath:"app/api/search/route"},resolvedPagePath:"/home/zen/Documents/rdv-frontend/app/api/search/route.tsx",nextConfigOutput:"",userland:o}),{requestAsyncStorage:h,staticGenerationAsyncStorage:d,serverHooks:g}=p,m="/api/search/route";function f(){return(0,a.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:d})}},5662:(e,r,t)=>{t.d(r,{AX:()=>n,OQ:()=>o,hE:()=>s});let o=(0,t(2885).createClient)("https://btpuvblcktpeplfkwcbr.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ0cHV2Ymxja3RwZXBsZmt3Y2JyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI5Mzk1ODcsImV4cCI6MjA1ODUxNTU4N30.949K9yGdElNqqJbeg1tB-0zmOxocsnacP_IW7a96mdw");async function n(e){console.log(`Fetching article with slug: ${e}`);let{data:r,error:t}=await o.from("article_with_sections").select("*").eq("slug",e).eq("status","published").eq("is_primary",!0).single();return t||!r?(console.error(`Article not found: ${e}`,t),null):(console.log(`Found article: ${r.title}`),r)}async function s(e,r=1,t=12){console.log(`Fetching parent section articles for: ${e}, page ${r}`);let{data:n,error:s}=await o.from("section_hierarchy").select("*").eq("slug",e).single();if(s||!n)return console.error(`Parent section not found: ${e}`,s),{articles:[],count:0};console.log("Parent section found:",n),console.log(`Parent section ID: ${n.id}, Path: ${n.path}`);let{data:i,error:c}=await o.rpc("get_section_tree",{parent_path:n.path});if(c){console.error("Error fetching child sections:",c),console.log("Falling back to parent section only");let e=[n.id];return await a(e,r,t)}console.log(`Found ${i?.length||0} sections in hierarchy:`,i);let l=i?.map(e=>e.id)||[n.id];return 0===l.length&&(console.log("No sections found in hierarchy, using parent only"),l.push(n.id)),await a(l,r,t)}async function a(e,r,t){console.log("Querying articles with section_ids:",e);let{count:n,error:s}=await o.from("article_with_sections").select("*",{count:"exact",head:!0}).in("section_id",e).eq("status","published");s&&console.error("Error counting articles:",s),console.log(`Total articles found in hierarchy: ${n}`);let{data:a,error:i}=await o.from("article_with_sections").select("*").in("section_id",e).eq("status","published").order("created_at",{ascending:!1}).range((r-1)*t,r*t-1);return i?(console.error("Error fetching articles:",i),{articles:[],count:0}):(console.log(`Found ${a?.length||0} articles for page ${r}`),console.log("Sample articles:",a?.slice(0,2)),{articles:a||[],count:n||0})}}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),o=r.X(0,[948,972],()=>t(3293));module.exports=o})();