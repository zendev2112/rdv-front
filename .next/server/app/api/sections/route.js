"use strict";(()=>{var e={};e.id=123,e.ids=[123],e.modules={2885:e=>{e.exports=require("@supabase/supabase-js")},399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},2051:(e,t,o)=>{o.r(t),o.d(t,{originalPathname:()=>g,patchFetch:()=>m,requestAsyncStorage:()=>d,routeModule:()=>u,serverHooks:()=>h,staticGenerationAsyncStorage:()=>p});var r={};o.r(r),o.d(r,{GET:()=>l});var n=o(9303),s=o(8716),i=o(670),a=o(7070),c=o(5662);async function l(){let{data:e,error:t}=await c.OQ.from("section_hierarchy").select("id, name, slug, level, parent_id, breadcrumb_slugs").order("level",{ascending:!0}).order("name",{ascending:!0});return t?(console.error("Error fetching sections:",t),a.NextResponse.json({error:"Failed to fetch sections"},{status:500})):a.NextResponse.json({sections:e})}let u=new n.AppRouteRouteModule({definition:{kind:s.x.APP_ROUTE,page:"/api/sections/route",pathname:"/api/sections",filename:"route",bundlePath:"app/api/sections/route"},resolvedPagePath:"/home/zen/Documents/rdv-frontend/app/api/sections/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:p,serverHooks:h}=u,g="/api/sections/route";function m(){return(0,i.patchFetch)({serverHooks:h,staticGenerationAsyncStorage:p})}},5662:(e,t,o)=>{o.d(t,{AX:()=>n,OQ:()=>r,hE:()=>s});let r=(0,o(2885).createClient)("https://btpuvblcktpeplfkwcbr.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJ0cHV2Ymxja3RwZXBsZmt3Y2JyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI5Mzk1ODcsImV4cCI6MjA1ODUxNTU4N30.949K9yGdElNqqJbeg1tB-0zmOxocsnacP_IW7a96mdw");async function n(e){console.log(`Fetching article with slug: ${e}`);let{data:t,error:o}=await r.from("article_with_sections").select("*").eq("slug",e).eq("status","published").eq("is_primary",!0).single();return o||!t?(console.error(`Article not found: ${e}`,o),null):(console.log(`Found article: ${t.title}`),t)}async function s(e,t=1,o=12){console.log(`Fetching parent section articles for: ${e}, page ${t}`);let{data:n,error:s}=await r.from("section_hierarchy").select("*").eq("slug",e).single();if(s||!n)return console.error(`Parent section not found: ${e}`,s),{articles:[],count:0};console.log("Parent section found:",n),console.log(`Parent section ID: ${n.id}, Path: ${n.path}`);let{data:a,error:c}=await r.rpc("get_section_tree",{parent_path:n.path});if(c){console.error("Error fetching child sections:",c),console.log("Falling back to parent section only");let e=[n.id];return await i(e,t,o)}console.log(`Found ${a?.length||0} sections in hierarchy:`,a);let l=a?.map(e=>e.id)||[n.id];return 0===l.length&&(console.log("No sections found in hierarchy, using parent only"),l.push(n.id)),await i(l,t,o)}async function i(e,t,o){console.log("Querying articles with section_ids:",e);let{count:n,error:s}=await r.from("article_with_sections").select("*",{count:"exact",head:!0}).in("section_id",e).eq("status","published");s&&console.error("Error counting articles:",s),console.log(`Total articles found in hierarchy: ${n}`);let{data:i,error:a}=await r.from("article_with_sections").select("*").in("section_id",e).eq("status","published").order("created_at",{ascending:!1}).range((t-1)*o,t*o-1);return a?(console.error("Error fetching articles:",a),{articles:[],count:0}):(console.log(`Found ${i?.length||0} articles for page ${t}`),console.log("Sample articles:",i?.slice(0,2)),{articles:i||[],count:n||0})}}};var t=require("../../../webpack-runtime.js");t.C(e);var o=e=>t(t.s=e),r=t.X(0,[948,972],()=>o(2051));module.exports=r})();